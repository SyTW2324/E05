name: CI

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: 14

    - name: Install dependencies
      run: npm install 
    
    - name: Install dependencies client
      run: cd client && npm install
    
    - name: Install dependencies server
      run: cd server && npm install 

    - name: Install curl
      run: sudo apt-get install curl

    - name: Install nvm
      run: |
        wget -qO- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash
        export NVM_DIR="$HOME/.nvm"
        [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
        [ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion
        nvm --version

    - name: Install nvm version
      run: nvm install 16 

    - name: Use nvm version
      run: nvm use 16

    - name: Start program
      run: npm run start

    - name: Wait for server to start
      run: sleep 10s
    
    - name: Run tests
      run: npm run test1
